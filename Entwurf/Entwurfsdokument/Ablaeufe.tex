\chapter{Abläufe}

\section{Sequenzdiagramme}

\subsection{Challengeende}

Knot ruft bei Kantenänderungen eine Methode auf, die ihm beim Hinzufügen zum \class{ChallengeModeScreen} zugewiesen wurde. Diese prüft die beiden Knoten auf Gleichheit, indem sie die Knoten sich vergleichen lässt. Sind beide \class{Knot}en gleich, wird die benötigte Zeit ermittelt und ein neuer \class{Dialog} erstellt, der die Zeit anzeigt und nach einem Benutzernamen fragt.
\newline
\newline
Dazu wird aus Options.Default der Benutzernamen abgefragt und als Standardwert eingetragen. Wird ein neuer Benutzername eingegeben, wird dieser auch in Options.Default geändert. Mit Enter bestätigt wird eine zugewiesene Methode aufgerufen, die Benutzername und Zeit \class{Challenge} mit AddToHighscore(name, time) übergibt, was die Werte richtig einordnet und gegebenenfalls (wenn die Zeit gut genug ist) speichert.
\newline
\newline
Daraufhin öffnet diese Methode einen neuen \class{Dialog}, der die besten 10, soweit vorhanden, anzeigt und 2 Buttons 
von denen einer die \class{Challenge} neu startet und ein anderer den StartScreen aufruft.

\subsection{Screenwechsel vom CreativeMainScreen in den CreativeLoadScreen}

Wenn man in dem Menü, das durch den \class{CreativeMainScreen} dargestellt wird, auf den Button "Load" klickt, wird der Wechsel zu \class{CreativeLoadScreen} eingeleitet. Dabei wird ein neues \class{CreativeLoadScreen} erstellt und oben auf den Stack in \class{Knot3Game} gelegt, in dem die Spielstände abgespeichert werden.
\newline
\newline
Beim nächsten Update()-Call des XNA-Frameworks wird der PostProcessingEffect von \class{CreativeLoadScreen} für ein Überblenden der Rendertargets auf \class{FadeEffect} gesetzt und der \class{CreativeMainScreen} wird deaktiviert, d.h. alle \interface{IGameScreenComponent}s von \class{CreativeMainScreen} werden aus der Liste der aktuell in XNA registrierten \interface{IGameScreenComponent} gelöscht. Außerdem wird die BeforeExit()-Methode von \class{CreativeMainScreen} aufgerufen, in der eventuell anfallende Aufräumarbeiten ausgeführt werden können.
\newline
\newline
Dann wird \class{CreativeLoadScreen} aktiviert und dessen Entered()-Methode aufgerufen, die dessen \interface{IGameScreenComponent}s mittels der in \class{GameScreen} implementierten AddGameComponents()-Methode in die \xna{IGameComponent}-Liste des XNA-Frameworks einträgt. Diese Operation ist rekursiv, d.h. die über die SubComponents()-Methode jedes \interface{IGameScreenComponent}s ermittelten Unterkomponenten werden von AddGameComponents() ebenfalls erfasst.
\newline
\newline
In diesem Beispiel wäre eine direkt von \class{CreativeLoadScreen} hinzugefügte Komponente das Spielstand-Menü, das von der Klasse \class{VerticalMenu} repräsentiert wird. Dieses gibt über die SubComponents()-Methode alle in dem Menü enthaltenen \class{MenuItem}s zurück, damit diese von AddGameComponents() ebenfalls als \interface{IGameScreenComponent} registriert und dargestellt werden können.
\newline
\newline
Daraufhin durchsucht \class{CreativeLoadScreen} das Spielstand-Verzeichnis und lädt die Metadaten der Speicherstände aller zwischengespeicherten Knoten.
Noch nicht zwischengespeicherte Knoten werden auf Gültigkeit überprüft und wenn für Gültig befunden in den Zwischenspeicher geschrieben als Hash.
\newline
\newline
Anschließend werden die gefundenen gültigen Spielstände in ein Menü eingetragen, welches dann beim nächsten Draw()-Call von XNA auf den Bildschirm gezeichnet wird.
Dieses Menü ist ein \class{VerticalMenu}, welches einen \class{MenuButton} für jeden gültigen gefundenen Spielstand enthält. Durch einen Klick auf den jeweiligen Button startet man mit dem Spielstand im \class{CreativeModeScreen}.
